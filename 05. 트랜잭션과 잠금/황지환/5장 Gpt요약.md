# 🎯 MySQL 트랜잭션 & 잠금 면접 요약 카드

## 🧩 1️⃣ 트랜잭션 (Transaction)
- **정의:** 논리적 작업 단위 — 전부 수행되거나 전혀 수행되지 않아야 함 (ACID 보장).
- **Lock:** 트랜잭션 간 충돌 방지를 위한 동시성 제어 장치.
- **격리 수준:** 다른 트랜잭션과의 데이터 공유 범위 결정.
- **주의:** 네트워크·I/O 포함 금지, 필요한 최소 코드 범위에만 적용.
- **핵심 키워드:** 정합성, 원자성, 커밋·롤백, 최소 범위 적용.

## ⚙️ 2️⃣ MySQL 엔진 잠금 (Server-level Locks)
- **특징:** 모든 스토리지 엔진에 영향 (전역 범위).
- **글로벌 락:** 서버 전체를 잠금 — 백업 시 일관된 시점 확보용.
- **백업 락:** DML 허용, DDL 차단 — 복제/백업 일관성 유지.
- **테이블 락:** 개별 테이블 단위 잠금 — DDL 수행 시 자동 획득.
- **네임드 락:** 문자열 기반 논리 락(`GET_LOCK`) — 다중 서버 배치 동시 실행 방지.
- **메타데이터 락:** 테이블·뷰 구조 변경 보호 — 객체 정의 보호용.

> 💡 “엔진 잠금은 서버 전역에서 스키마·백업·배치 동작을 일관되게 유지하기 위한 보호 장치입니다.”

## 🧱 3️⃣ InnoDB 스토리지 엔진 잠금 (Storage-level Locks)
- **특징:** 인덱스 기반의 세밀한 레코드 단위 잠금.
- **레코드 락:** 인덱스 엔트리 단위 잠금 — 기존 데이터 수정 방지.
- **갭 락:** 레코드 간 간격 잠금 — 새로운 INSERT 차단 (팬텀 리드 방지).
- **넥스트 키 락:** 레코드락 + 갭락 — 수정·삽입 모두 방지.
- **자동 증가 락:** AUTO_INCREMENT 값 할당 시 테이블 단위 순간 락.
- **조회:** `INNODB_TRX`, `INNODB_LOCKS`, `INNODB_LOCK_WAITS` 테이블로 확인 가능.

> 💡 “InnoDB는 데이터가 아닌 인덱스 레코드를 잠그며, 갭락·넥스트키락으로 팬텀 리드를 물리적으로 차단합니다.”

## 🧮 4️⃣ 트랜잭션 격리 수준 (Isolation Level)

| 수준 | 특징 | 발생 문제 | 주요 사용처 |
|------|------|------------|-------------|
| **READ UNCOMMITTED** | 커밋 전 변경도 읽음 | Dirty / Non-repeatable / Phantom | 테스트 전용 |
| **READ COMMITTED** | 커밋된 데이터만 읽음 (Undo Log 활용) | Non-repeatable / Phantom | Oracle 기본 |
| **REPEATABLE READ** | 트랜잭션 시작 시 스냅샷 유지 (MVCC) | 새 행 미포함(의도적) | MySQL 기본 |
| **SERIALIZABLE** | 완전 직렬 실행 (SELECT도 공유락) | 성능 저하 | 금융 등 완전 일관성 필요 |

> 💡 “MySQL의 기본 격리 수준은 REPEATABLE READ이며, MVCC와 갭락으로 팬텀 리드를 방지합니다.”

## 🧠 5️⃣ 인덱스와 잠금 관계
- InnoDB는 **“데이터”가 아닌 “인덱스 엔트리”를 잠금.**
- 인덱스가 없으면 테이블 전체 스캔으로 확장 (lock escalation 유사).
- 인덱스 설계는 곧 잠금 범위와 성능에 직결됨.

> 💡 “InnoDB는 인덱스 단위로 잠금하므로, 인덱스 부재 시 테이블 전체가 잠길 수 있습니다.”

## 🧩 6️⃣ 한눈에 요약

| 구분 | 역할 | 키워드 |
|------|------|--------|
| **트랜잭션** | 데이터 정합성 | ACID, Commit, Rollback |
| **엔진 잠금** | 전역 제어 | 글로벌락, 백업락, 네임드락 |
| **InnoDB 잠금** | 레코드 단위 제어 | 레코드락, 갭락, 넥스트키락 |
| **격리 수준** | 트랜잭션 간 데이터 공유 범위 | MVCC, Undo Log, Phantom |
| **자동 증가 락** | ID 충돌 방지 | 테이블 단위 순간 락 |
| **메타데이터 락** | 구조 변경 보호 | 객체 단위 락 |
"""
